<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏Ç‡∏≠‡∏•‡∏≤‡∏á‡∏≤‡∏ô</title>

    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link href="style.css" rel="stylesheet">

  </head>
  <body>
    <div class="container">
      <h2>‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏Ç‡∏≠‡∏•‡∏≤‡∏á‡∏≤‡∏ô</h2>
        <p id="userId"><b>userId : </b></p>
        <input type="hidden" id="uid">

        <label>‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•</label>
        <input type="text" name="name" id="name" required />

        <label>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡∏•‡∏≤</label>
        <select name="type" id="type">
          <option value="‡∏•‡∏≤‡∏Å‡∏¥‡∏à">‡∏•‡∏≤‡∏Å‡∏¥‡∏à</option>
          <option value="‡∏•‡∏≤‡∏õ‡πà‡∏ß‡∏¢">‡∏•‡∏≤‡∏õ‡πà‡∏ß‡∏¢</option>
        </select>

        <label>‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏ß‡∏±‡∏ô‡∏•‡∏≤</label>
        <select name="pattern" id="pattern" required>
          <option value="‡∏•‡∏≤‡πÄ‡∏ï‡πá‡∏°‡∏ß‡∏±‡∏ô">‡∏•‡∏≤‡πÄ‡∏ï‡πá‡∏°‡∏ß‡∏±‡∏ô</option>
          <option value="‡∏•‡∏≤‡∏Ñ‡∏£‡∏∂‡πà‡∏á‡∏ß‡∏±‡∏ô‡πÄ‡∏ä‡πâ‡∏≤">‡∏•‡∏≤‡∏Ñ‡∏£‡∏∂‡πà‡∏á‡∏ß‡∏±‡∏ô‡πÄ‡∏ä‡πâ‡∏≤</option>
          <option value="‡∏•‡∏≤‡∏Ñ‡∏£‡∏∂‡πà‡∏á‡∏ß‡∏±‡∏ô‡∏ö‡πà‡∏≤‡∏¢">‡∏•‡∏≤‡∏Ñ‡∏£‡∏∂‡πà‡∏á‡∏ß‡∏±‡∏ô‡∏ö‡πà‡∏≤‡∏¢</option>
        </select>

        <label>‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏•‡∏≤</label>
        <input type="date" name="start_date" id="start_date" required />

        <label>‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î</label>
        <input type="date" name="end_date" id="end_date" required />

        <label>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ß‡∏±‡∏ô</label>
        <input type="number" name="count_day" id="count_day" min="1" required />

        <label>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</label>
        <textarea name="note" id="note"></textarea>

        <button onclick="submitForm()">‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠</button>
    </div>

   <script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
  import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-analytics.js";

  // ‚òÖ‚òÖ Firestore ‚òÖ‚òÖ
  import { 
    getFirestore, 
    collection, 
    addDoc 
  } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyC1qq59U0moH20dOCpAITNFR9ttHLxTRFg",
    authDomain: "pt-test-b0dc9.firebaseapp.com",
    projectId: "pt-test-b0dc9",
    storageBucket: "pt-test-b0dc9.firebasestorage.app",
    messagingSenderId: "1938984234",
    appId: "1:1938984234:web:89078e2d16c3958cc6a253",
    measurementId: "G-F2KV6LY4XE"
  };

  const app = initializeApp(firebaseConfig);
  const analytics = getAnalytics(app);
  const db = getFirestore(app);   // ‚Üê ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ

  // ====== LIFF ======
  async function main() {
    await liff.init({ liffId: "2008650824-wo3yRXa9" });
    if (liff.isLoggedIn()) {
      getUserProfile();
    } else {
      liff.login();
    }
  }
  main();

  async function getUserProfile() {
    const profile = await liff.getProfile();
    document.getElementById("userId").append(profile.userId);
    document.getElementById("uid").value = profile.userId;
  }

  // ====== ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á Firestore ======
  async function saveToFirestore() {
    const data = {
      userId: document.getElementById("uid").value,
      name: document.getElementById("name").value,
      type: document.getElementById("type").value,
      pattern: document.getElementById("pattern").value,
      start_date: document.getElementById("start_date").value,
      end_date: document.getElementById("end_date").value,
      count_day: document.getElementById("count_day").value,
      note: document.getElementById("note").value,
      timestamp: new Date(),
    };

    try {
      await addDoc(collection(db, "leave_form"), data);
      alert("‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à üëç");
    } catch (e) {
      console.error("Error adding document: ", e);
      alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•");
    }
  }

  window.submitForm = function () {
    saveToFirestore();
  };
</script>
  </body>
</html>
